<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NYC DRAMA LIVE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #121212; color: #ffffff; font-family: 'Inter', sans-serif; }
        .btn-active { background: #ff3366 !important; color: white !important; }
        .drama-card { 
            background: #1e1e1e; 
            border: 1px solid #333; 
            border-radius: 12px; 
            transition: all 0.3s ease; 
            opacity: 0; 
            transform: translateY(20px);
        }
        .drama-card.show { opacity: 1; transform: translateY(0); }
        .drama-card:hover { border-color: #ff3366; transform: translateY(-4px); box-shadow: 0 8px 25px rgba(255,51,102,0.2); }
        .map-container { border: 1px solid #333; border-radius: 12px; overflow: hidden; }
        h1, h3 { font-weight: 700; }
    </style>
</head>
<body>
<div class="container py-5">
    <h1 class="text-center display-5 mb-2">NYC DRAMA LIVE</h1>
    <p class="text-center text-muted mb-1">Last 24 hours • {{ total }} complaints</p>
    <p class="text-center text-muted mb-4">Borough: <strong>{{ borough }}</strong></p>

    <div class="text-center mb-5">
        <a href="/" class="btn {% if borough == 'ALL' %}btn-active{% else %}btn-outline-light{% endif %} me-2">ALL BOROUGHS</a>
        <a href="/?borough=BROOKLYN" class="btn {% if borough == 'BROOKLYN' %}btn-active{% else %}btn-outline-light{% endif %} me-2">BROOKLYN</a>
        <a href="/?borough=MANHATTAN" class="btn {% if borough == 'MANHATTAN' %}btn-active{% else %}btn-outline-light{% endif %} me-2">MANHATTAN</a>
        <a href="/?borough=QUEENS" class="btn {% if borough == 'QUEENS' %}btn-active{% else %}btn-outline-light{% endif %}">QUEENS</a>
    </div>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <h3>Latest Drama</h3>
            <div id="drama-list">
                {% for c in complaints %}
                <div class="drama-card p-3 mb-3">
                    <h6 class="text-danger mb-1">URGENT: {{ c.descriptor }}</h6>
                    <p class="mb-0 text-light">{{ c.incident_address }} • {{ c.created_date[11:16] }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="col-lg-6">
            <h3>Live Map</h3>
            <div class="map-container">
                {{ map_html | safe }}
            </div>
        </div>
    </div>
</div>

<script>
    // Анимация появления карточек
    document.querySelectorAll('.drama-card').forEach((card, i) => {
        setTimeout(() => card.classList.add('show'), i * 100);
    });

    // WebSocket real-time
    const ws = new WebSocket("wss://" + location.host + "/ws");
    ws.onmessage = (e) => {
        const data = JSON.parse(e.data);
        const list = document.getElementById('drama-list');
        list.innerHTML = '';
        data.drama.forEach((d, i) => {
            const div = document.createElement('div');
            div.className = 'drama-card p-3 mb-3';
            div.innerHTML = `<h6 class="text-danger mb-1">URGENT: ${d.split(' — ')[0]}</h6>
                            <p class="mb-0 text-light">${d.split(' — ')[1] || d}</p>`;
            setTimeout(() => div.classList.add('show'), i * 100);
            list.appendChild(div);
        });
    };
</script>
</body>
</html>